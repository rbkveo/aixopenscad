# AiXopenscad

AiXopenscad is a web-based, AI-powered 3D modeling application that integrates OpenSCAD code generation, rendering, and validation directly in the browser. It leverages WebAssembly (WASM) to run OpenSCAD locally, integrates with advanced LLMs (Gemini and Ollama) for code generation, and uses Three.js for responsive 3D visualization.

## Features

- **In-Browser OpenSCAD Rendering:** Compile and render OpenSCAD scripts locally using WebAssembly.
- **AI-Powered Code Generation:** Describe your 3D model, and the AI (Gemini or Ollama) will generate the corresponding OpenSCAD code using BOSL2 library standards.
- **Retrieval-Augmented Generation (RAG):** Context-aware AI responses fueled by OpenSCAD techniques and BOSL2 documentation.
- **Interactive 3D Viewer:** View, pan, orbit, and capture screenshots of your rendered 3D models using Three.js.
- **Integrated Code Editor:** A specialized Monaco editor tailored for OpenSCAD scripting.
- **Visual Quality Assurance:** The AI can analyze screenshots of the rendered geometry to debug and improve models.
- **Cloud Synchronization:** Authentication and chat history management via Supabase.

## Getting Started

### Prerequisites

- [Node.js](https://nodejs.org/) (v18 or higher recommended)
- [npm](https://www.npmjs.com/) or [yarn]
- Access to [Ollama](https://ollama.ai/) (optional, if running local LLMs)
- An active [Google Gemini API Key](https://aistudio.google.com/)

### Installation

1. **Clone the repository:**
   ```bash
   git clone <repository_url>
   cd AiXopenscad
   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Configure Environment Variables:**
   Copy the example environment file and fill in your details:
   ```bash
   cp .env.example .env
   ```
   *Edit `.env` to include your `VITE_GEMINI_API_KEY`, `VITE_OLLAMA_HOST` (if applicable), and your Supabase credentials.*

### Running the Application

**Development Mode:**
```bash
npm run dev
```
The app will start rapidly with Vite. Open your browser and navigate to the local server URL provided in your terminal (usually `http://localhost:5173`).

**Production Build:**
```bash
npm run build
npm run preview
```

**Docker Support:**
A `.dockerignore`, `Dockerfile` and `docker-compose.yml` are provided. To deploy via Docker:
```bash
docker-compose up --build -d
```

## Project Structure

The project follows a modular React/Vite structure:

### `/src` (Application Source Code)

- **`App.jsx` & `main.jsx`**: The root application components and entry points. Contains layout and context providers.
- **`components/`**: React UI components divided by feature domain.
  - **`Viewer/3DViewer.jsx`**: Handles the Three.js canvas, rendering the STLs generated by OpenSCAD, controlling camera modes (Pan/Orbit), and handling screenshot logic.
  - **`Editor/CodeEditor.jsx`**: Wraps the Monaco editor for OpenSCAD syntax highlighting and real-time code editing.
  - **`Auth/AuthModal.jsx`**: User authentication forms and modal UI connected to Supabase.
- **`services/`**: Core business logic and external integrations.
  - **`AIService.js`**: Central controller for LLM interactions. Communicates with Gemini / Ollama, injects system prompts and RAG context, performs visual QA, and manages automated code fixing (linting and CGAL assertions).
  - **`OpenSCADService.js`**: Manages the `openscad-wasm` runtime. Compiles OpenSCAD code into STLs/CSGs directly in the browser environment.
  - **`RAGService.js`**: Handles searching the local vector/index databases to provide accurate documentation and BOSL2 references to the AI models.
  - **`GeometryValidator.js`**: Validates the output geometry for common OpenSCAD/CGAL errors (like empty geometry, non-manifold edges) to trigger auto-fixes.
  - **`SupabaseService.js`**: Wraps backend interactions for users and chat message persistence.
  - **`LocalDBService.js`**: Wraps IndexedDB primarily for local caching of RAG data and temporary app states.
  - **`ImageService.js`**: Helper methods for converting and manipulating images / canvas data (for AI vision).
  - **`LoggingService.js`**: Uniform pipeline logging utility functions.

### Other Directories

- **`/rag_data`**: Contains markdown documentation, BOSL2 references, and OpenSCAD examples. Processed and ingested into the local index so the AI has specific, safe design patterns.
- **`/public`**: Static assets, including standard BOSL2 libraries, CSS overrides, and the raw WASM binary files.

## Technology Stack

- **Frontend Framework:** React 19, Vite
- **3D Rendering:** Three.js
- **Code Editor:** Monaco Editor (@monaco-editor/react)
- **OpenSCAD Engine:** openscad-wasm
- **AI Integration:** @google/genai, ollama/browser
- **Backend & Auth:** Supabase

## Contributing

1. Create a feature branch (`git checkout -b feature/your-feature`)
2. Commit your changes (`git commit -m 'Add some feature'`)
3. Push to the branch (`git push origin feature/your-feature`)
4. Open a Pull Request.

Make sure your code conforms to the ESLint rules by running `npm run lint` before committing.
